# 基于区块链的献血管理研究

文案大致内容：

#### 一：背景与现状

​    1.1献血的发展史

​    1.2我国献血所存在的问题

#### 二：区块链与新型献血管理的实用性分析

#### 三：基于区块链的献血管理研究方案设计

​    **3.1.1 业务设计**

​        3.1.1.2 RFID血袋

​    **3.2.1 架构设计**

​    **3.3.1 交互设计**

​          3.3.1.1身份认证阶段

​          3.3.1.2献血认证阶段

​          3.3.1.3血液使用阶段

#### 四：关键技术与方法

​      **4.1.1 以太坊账户体系**

​      **4.2.1 以太坊的技术架构**

​      **4.3.1 以太坊的智能合约**

​             4.3.1.1智能合约简介

​             4.3.1.2以太坊智能合约的运行原理

​     **4.4.1 以太坊的可信存证机制**

​            4.4.1.1 存储可信性

​            4.4.1.2 访问可信性

​            4.4.1.3 处理可信性

#### 五：搭建及部署私有以太坊

#### 六：应用与实践设计 

#### 七：新型献血管理的应用前景  

#### 八：方案总结









### 二：区块链与新型献血管理的实用性分析

​     **(1）信息更加安全可靠**：将区块链技术引入献血管理之后，我们的献血证将迎来历史性改变，我们将会拥有一个电子献血证。我们都知道区块链技术是一种新型分布式数据组织方法及运算方式，通过去中心化来集体维护一个可靠数据库的技术。在数据共享过程中可明确数据 的来源、所有权和使用权，达到数据在存储上不可篡改、在流通上路径可追溯、在数据管理上可审计的目的，保证数据在存储、共享、审计等环节中的安全，实现真正意义上的数据全流程管理。介时我们可以在献血证上面储存更多的信息，比如直系亲属等等，这些信息被很好的保护起来，不会有被篡改和遗失的风险。

   **（2）打破传统信息交流模式**：区块链所采用的分布式数据结构模式，不需要构建多级数据管理中心，同时不需要跨部门，跨地区的数据集中，并且不会改变现有的医院，血站的业务系统。不仅如此，区块链所构建的新型部门协作模式，促进献血者、血站、血库、医院之间的可信信息流动，提高其协同的效应。与传统的数据集中共享模式比较起来，这种模式的效率和实行性更高。  。

​                 ![image-20201215102401924](https://i.loli.net/2020/12/15/hmu8xaybH36kn7r.png)

​         传统的信息交流流动仅限于血站和医院之间，献血者无法从医院和血站获取到自己的血液信息，病人也无法获取自己所得到的血液信息

 

​                             ![image-20201215102435083](https://i.loli.net/2020/12/15/GJFEijztsN1edbl.png)

  

​        采用这种信息交流模式，这将极大的促进血液信息在各个角色之间的流通，使得信息可            溯源，增加可信度，消除群众的疑惑。

​     **（3）可信的存在证明**：鲜血点通过对电子献血证的文件签名，将献血者的信息保存在区块链上面，可证明献血的某次献血行为的合法存在，杜绝了伪造献血证的现象，当你的血液信息上链之后，其他地方的血站也可以查询到你信息，介时你在外地鲜血的时候，可以证明你是否处于安全间隔期。这促进了社会互信，降低了公众信任成本提高了工作效率。

​    **（4）可审计性高**：电子献血证经过哈希运算备份保存在区块链上。由于加盖了时间戳使得每献血证上的信息可追溯、可证明。为不同地方的血站、医院提供了更加可信的数据支撑，避免了重复认证等不必要的措施，减少了资源的浪费。

   **（5) 信息互信互通**：主链进行身份认证，侧链认证血液、血液流通的信息，两条链双向锚定，实现证件照自由流动，逐步提高服务质量，助理诚信社会的建设





###  三：基于区块链的献血管理研究方案设计

####            **3.1.1 业务设计**

​        基于区块链的可信电子献血证用于部门给公民发放电子献血证。区块链共识算法驱动区块链上的每个节点都参与到交易的验证过程中，保证区块链上交易都是经过确认可信的，区块链上每个节点都维护一个公共的账本，任何一个节点对自己所维护的账本的修改都将不被其他节点所承认，从而保证公共账本不可被伪造和篡改，并且通过区块链保存的不可篡改的献血、用血的记录，使得血站、医院共同建造，共同维护；献血者、血站、医院、病人来共同监督，从而满足公众的知情权、监督权。以保持人们对于献血的积极性。

​       从业务功能上来说，新型的管理模式增加了一些模式，如下图3-1所示献血者首先向献血点申请一份专属于自己的电子献血证；献血环节血站通过区块链查询到献血者的信息，并查询他是否处于安全间隔期，并将血液装入一个带有RFID的血袋，RFID血袋将记录各种信息，再将RFID上传至电子献血证并且再次上链；医院从血站那里使用了带有RFID的血袋，使用信息将记录再电子献血证里面并再次上链。

​       ![image-20201215102929815](C:\Users\11609\AppData\Roaming\Typora\typora-user-images\image-20201215102929815.png)

  **1.申请**

   献血者首次献血的时候应该向血站提出申请，填写个人信息，以获得电子献血证

 

  **2.发证**

 为了实现电子献血证的发放，公民申请献血后，由血液管理中心发放。该证件可以通过客户端，电脑客   户端等集中渠道进行发放，申请的个人献血证通过客户端于后台进行统一管理。具体流程图如下：

（1）申请者通过手机客户端或者在献血点提供个人信息，申请一个数字身份。

（2）血液管理中心审核持证人的信息，生成个人数字身份；血液管理中心用其私钥对持证人的数字身份签名后，发送给持证人，以及向电网信 息中心报审/备案。

（3）持证人使用自己的公钥对接收到的有血液管理中心签名的数字身 份进行加密，并提交数字身份区块链。

（4）电子献血证区块链完成验证和共识过程,电子献血证发放成功

 **3.查验**

每当献血者献血的时候，献血点应对献血者的身份进行识别，并且查询献血者是否处于安全间隔期。献血点的工作人员可以通过手机客户端进行查验工作。以确保流程的安全具体流程如下

（1）持证人出示电子献血证上的身份码，供工作人员扫描；

（2）献血点工作人员利用公匙验证献血证的合法

（3）工作人员查询电子献血证上身份信息和上次献血的间隔期

**4.献血**

  献血点在确认献血者身份，准备好配有RFID的血袋，该血袋配对应唯一血液ID，通过计算机端向电子献血证写入献血者献血信息和血液的全流程数据，上传至区块链平台

**3.1.1.2 RFID血袋**

  无线射频识别即射频识别技术（Radio Frequency Identification，RFID），是自动识别技术的一种，通过无线射频方式进行非接触双向数据通信，利用\****[***\*无线射频\****](https://baike.baidu.com/item/无线射频/4142085)***\*方式对记录媒体（\****[***\*电子标签\****](https://baike.baidu.com/item/电子标签/6976650)***\*或射频卡）进行读写，从而达到识别目标和数据交换的目的

  所设的RFID血袋，对应唯一献血ID，可通过计算机读写端提前关联所属血站名称（许可证号、编号）、采血车编号信息；不仅如此，可通过计算机前端及时录入献血者基本信息（姓名、性别、血型）、献血时间及地点、运血车编号、使用机构名称（编号）、主治医生姓名。其中，最为关键的是，使用者的信息（姓名、性别、住院号、诊断结果、使用时间、使用量）这些平时我们无法得知的信息将得以查询。RFID血袋还将记录着“捐献-存储-运输-使用”的全流程信息上传至区块链平台。如下图3-2

​    ![image-20201215103942206](https://i.loli.net/2020/12/15/cSZyen895t7EDPk.png)

####      3.2.1 架构设计

​      我们采用以太坊技术作为支撑，结合新型管理模式的需要，我们设计了如下图3-3技术架构，主要为区块链构架、功能模块、用血流程。

​       ![image-20201215104122600](https://i.loli.net/2020/12/15/dT2pfKDNL9S1zRM.png)

​                                                                               图3-2

​     区块链构架：将献血者、血站、医院、血液使用情况进行区块化封装，连接成区块链；

​     功能模块以区块链构架为基础，提供区块链服务；

​     用户层表现形式为APP，机构前端，以实现用户与用户之间，用户与机构之间的信息交互。





![image-20201215104242550](https://i.loli.net/2020/12/15/dUNECIL41YiRgnT.png)

​                                                                                   图3-4

​      如上图3-4所示，我们对数据进行区块化封装，每个区块链有区块头和区块体两部分。其中，如图所示，迁移区块、时间戳、随机数、哈希值放在区块头里面。当前区块的交易以及通过验证的、每一个区块的创建过程中生成的所有记录封装在区块体中。区块 体由Merkle树组成，在Merkle树的叶子节点上，保存着每一笔发证、收 证、查证和换证的记录，这些数据通过两两Hash计算向上形成Merkle树 的根记入区块头





​       ![image-20201215104332717](https://i.loli.net/2020/12/15/JfLXrWkcVStwhYU.png)

​                                                                                                                  图3-5

​         根据新型献血的管理体系的类型，采用主链和侧链的双向锚定的设计加以区分。结果如上图3-5所示。如图显示，主链是用于身份验证，用于验证并存储献血者的信息。侧链则是血袋上的RFID里面所存储的信息。献血者完成身份认证后并献血之后，通过主链锚定其RFID信息，其每次献血都会有一个新的RFID，每个RFID都会对应一个主链。侧链的双向锚定拘束允许信任在不同网络之间传递，建立起新人体系；同时，如果遇上有新的版本更新，也是可以发布试用新版本，这对主链和侧链不会造成影响。

#### 3.3.1 交互设计

​         **3.3.1.1身份认证阶段**

​         身份认证系统主要涉及区块链平台、用户App和后台管理系统的交互。对于献血者注册系统有三个角色：献血者、血液管理中心、查验机构。如下图3-6是普通用户认证过程。

​       ![image-20201215104601059](https://i.loli.net/2020/12/15/kbA4GKqmYxREylT.png)

​                                                                                         图3-6

​        首先，献血者登陆注册系统，提交身份信息之后，后台管理系统进行身份认证。如果认证成功，则将献血者的信息写入身份管理数据系统，并返回注册成功信息，否则要重新注册；注册完成之后将生成一个区块链并得到一个区块链的ID，然后再生成公私匙，公匙公开私匙交于献血者保存。

​        其中，生成区块链的ID，我们将利用Hash算法将献血者信息（身份证上的基本信息）生成全网的唯一身份标识，根据这一个标识，我们可以判断该献血者是否是第一次献血。原则上同样的输入会有相同的Hash值产生，但是献血者的献血信息重复性就很低，所以可以完全避免该身份标识发生重复的现象。不仅如此，后台管理系统所保存的身份标识可以将认证机构根据用户信息生成的全网唯一身份标识与存储过的全网唯一身份标识进行对比，来判断该献血者是否是第一次献血：若未找到存储过的全网唯一身份标识则为第一次献血，否则为再次献血。后学，则由发证机构进行身份认证如图3-7

![image-20201215104740892](https://i.loli.net/2020/12/15/w9BltSUvpaOiLyN.png)

​                                                                                   图3-7 发证机构身份认证

   **3.3.1.2献血认证阶段**

   该阶段主要涉及用户APP、血液管理中心、区块链平台、后台管理系统之间的交互。如图3-8所示

 ![image-20201215104859964](https://i.loli.net/2020/12/15/A8oMGwjORbt9gFs.png)

​                                                                            图3-8

​        首先用户献血之后，将其献血记录、血液信息、血站及其运输信息记录到RFID中

​        其次，血站使用其公匙和用户的私匙进行两次加密，加密之后平台输出该笔交易的Hash值，并全网广播这笔交易，记录这次献血的信息的区块链编号，写入区块链。其它机构收到了血液管理中心发出的广播，并对献血者的身份进行了确认。

​        最后，献血者在APP上验证血液管理中心的签名，确保信息的准确性，在区块链上面用私匙解密完成确认，血液管理中心公匙解密作为存证。

  **3.3.1.3血液使用阶段**

  该阶段主要涉及用户APP、血液管理中心、区块链平台、后台管理系统以及医院之间的交互。如图3-9所示

​     ![image-20201215105103295](https://i.loli.net/2020/12/15/6SWLBmeoEf9iUpV.png)

​                                                                     图3-9

​        首先，医院发出用血要求，然后将患者、主治医生等信息提供给血液管理中心以供日后验证使用，血液管理中心拿出带有RFID血袋，交予医院。由于生命刻不容缓，所以验证加密工作可以在日后完成。

​        患者用血之后，将使用记录记录在RFID上，然后医院用私链血液管理中心用公链对此进行加密，加密之后区块链平台对此输出Hash值，并且广播此次交易记录，血液管理中心使用私匙解密验证是否是医院的签名，然后医院用公匙、血液管理中心用私匙进行解密，交易完成并且生成新的区块。

​        因为RFID也是献血者本次献血的血液的唯一ID，所以献血者会收到这个广播，如果他想查询信息可以向血液管理中心提出查询申请，血液管理中心则根据其申请者的信息与RFID上所对应的信息进行验证，通过验证给与申请者权限并告知其区块的所属ID以供申请者查询；反之则返回用户信息界面。

###     四：关键技术与方法

####             **4.2.1 以太坊的技术架构**

​            以太坊采用五层架构实现，从上到下分别是数据层、网络层、共识层、激励层、智能合约层、如图4-1所示

​                                         ![image-20201215110041186](https://i.loli.net/2020/12/15/QwR5LAV21CP9vxK.png)

​                                                                                             图4-1

​        **1.智能合约层**

​         智能合约赋予账本可编程的特性，区块链2.0通过虚拟机的方式运行代码实现智能合约的功能，比如以太坊的以太坊的虚拟机（EVM）。同时，这一层通过在智能合约上添加能够与用户交互的前台界面，形成去中心化的应用（DAPP）。当然，在某些技术文档中认为DAPP应该在智能合约上单独为应用层，也是有一定道理，只要不影响理解即可。

​        **2.激励层**

激励层主要实现以太币的发型和分配机制，以太币不是数字货币，而是定位于平台运行的燃料，运行智能合约和发送交易都需要向矿工支付一定的以太币。目前以太币可以通过挖矿获得，矿工每挖到一个区块都会奖励其以太币（数量不一定）。

​        **3.共识层**

共识层主要实现全网所有节点对交易和数据达成一致，以太坊采用两种共机制，初期采用工作量证明机制（POW），待网络中的以太币充分流通和分散后，改为采用交易速度更快、无资源消耗的权益证明机制（POS），从而有效地避免额纯POS机制导致的初期权益分配不公平的情况。

​        **4.数据层** 

数据层最底层，是一切的基础，主要实现了两个功能，一个是相关数据的存储，另一个是账户和交易的实现与安全。数据存储只要基于Merkle树，通过区块的方式和链式结构实现，大多数以KV（Key-Value）数据库的方式实现持久化，比如以太坊采用LevelDB。账号和交易的实现基于数字签名、哈希函数和非对称加密技术等多种密码学算法和技术、保证了交易的去中心化的情况下能够安全地进行。 

####       **4.3.1 以太坊的智能合约** 

​            **4.3.1.1智能合约简介**

​           典型的智能合约模型如图4-2所示

​            ![image-20201215110746078](https://i.loli.net/2020/12/15/Ql9i7DdBkVw3LXe.png)

​                                                                                         图4-2

​              从本质上来讲，智能合约也是一段程序，但是与传统的IT系统不同，智能合约继承了区块链的三个特性：数据透明、不可篡改、永久运行。

（1）数据透明

区块链上所有的数据都是公开透明的，因此智能合约的数据处理也是公开透明的，运行时任何一方都可以查看其代码和数据

（2）不可篡改

区块链本身所有数据不可篡改，因此部署在区块链上的智能合约代码以及运行产生的数据输出也是不可篡改的，运行智能合约的节点不必担心其它节点恶意修改代码与数据。

  （3）永久运行

支撑区块链网络节点往往达到数百甚至上千，部分节点的失效不会导致智能和玉的停止，其可靠性理论上接近于永久运行，这样确保了智能合约能像纸质合约一样每时每刻都有效。

   **4.3.1.2以太坊智能合约的运行原理**

智能合约是部署在区块链的代码，区块链本身不能执行代码，代码的执行是每个节点通过虚拟机实现，智能合约的运行原理如图4-3所示。

![image-20201215110959436](https://i.loli.net/2020/12/15/mG9ksron36hPVbC.png)

​                                                                                                图4-3

**（1）以太坊虚拟机**

 以太坊虚拟机是以以太坊中智能合约的运行环境。智能合约可以比作是java程序，java程序通过java虚拟机（JVM）将代码解释字节进行执行，以太坊的智能合约通过以太坊虚拟集解释成字节码进行执行。EVM被沙箱封装起来，也就是说在EVM内部的代码不能接触到网络、文件系统或者其它进程，甚至智能合约与之智能合约之间的调用也有些限制。

**（2）RPC接口**

RPC接口是以太坊与其它IT系统交互的接口，以太坊节点在8545端口提供了JSON RPC API接口，数据传输采用JSON格式，可以执行Web3库的各种命令，可以向前端，比如Mist等图形化客户端提供区块链的信息。

如图4-3可以看出，部署在区块链上的智能合约是一段能够在本地产生原智能合约代码的数据串，可以理解区块链为一个数据库，而客户端通过发起一笔交易，告诉以太坊节点需要调用的函数及相关参数，所有的以太坊节点都会接受到这笔交易，然后从区块链这个数据库中读取了存储智能合约的运行代码，在本地EVM运行出结果。为避免节点作恶，节点运行智能合约的结果将与其它以太坊节点进行对比，最后确认无误之后才将结果写入区块链中，从而实现智能合约的正确执行。

**4.4.1 以太坊的可信存证机制**

所有的数据及操作都被永久地记录在数据区块供用户访问。这些存证数据所在地数据区块被同步存储在系统地每一个参与运算的节点中，所有这些节点构成了可信存证系统及其坚韧的分布式数据管理系统，任何一个节点上的数据被破坏可以通过同步节点或访问其他哈希节点得到验证；同时任何一个节点上的数据区块被破坏都不会影响整个可信存证系统的正常运转。下面我们对系统的可信性进行分析。

**4.4.1.1 存储可信性**

存储可信性是指数据存储的正确性，即使系统在存储、通信过程中发生故障，甚至被恶意攻击时，只要数据处理结果被确认，存储的数据就不被篡改或者丢失。以太坊平台整体上可划分为网络层、共识层、数据层、智能合约层和激励层(应用层)5 个层次。

**在网络层**，以太坊平台以完全分布且可容忍单点故障的 P2P 协议作为网络传输协议，用于节点间传输交易数据和区块数据。节点之间以扁平拓 扑结构相互连通，不存在中心化节点，具有平等、自治、分布等特性。在数据传输过程中，网络中广播的数据由节点负 责时刻监听，当接收到相邻节点发来的新交易和新区块时，节点首先会通过工作量证明或数字签名等来验证交易和区块 的有效性，验证通过后，新交易加入到正在构建的区块，新区块连接到区块链当中，确保了数据的有效性与可信性。

**在共识层**，以太坊依赖于工作量证明机制来解决区块的容错一致问题。PoW 机制依靠分布式节点的算力竞争来保证全网数据的一致性和安全性，它要求每个节点基于自身算力解决求解复杂但验证简单的 SHA256 计算难题，即寻找一个合适的随机数，使得区块头部元数据的SHA256哈希值小于区块头中难度目标的设定值。如果有人想要篡改或者伪造其中一个区块，就必须针对该区块及其后所有的区块，重新寻找区块头的随机数，构造出一条比当前被公认的区块链主 链更长的链，这个恶意过程所需要消耗的算力超过了整个区块链中正在进行正常挖矿运算的算力总和，因此恶意攻击的 难度和成本很高。PoW机制融合了经济激励政策与共识算法，促使更多以太坊节点参与到挖矿运算，主动增强了网络的可靠性与安全性。

**在数据层**，以太坊中每个区块包含区块头和区块体两部分，区块体存放交易数据，区块头存放父区块哈希、时间戳、 Merkle 根等数据，其中父区块哈希构建了区块链以区块为单位的链式结构，保证了数据数据的不可篡改性，时间戳是该区块的生成时间，基于交易哈希生成的 Merkle 根确保了区块内交易数据的完整性与可信性。因此，区块链特殊的数据结构保证了所有区块环环相扣，任一区块被篡改，都会引起其后续所有区块哈希指针的连环变化。

**在智能合约层**，以太坊实现了Casper共识。从前所述，PoW 牺牲性能来换取数据的一致性和安全性，针对PoW 机制低效耗能的缺陷，以太坊平台引入 PoS 机制，根据矿工在区块链中拥有的股权来决定其挖矿的难度，当矿工拥有越多的以太币，越容易找到合适的随机数，挖矿的整体难度就会越低。以太坊又基于 PoS 机制提出 Casper 共识，要求矿工购买以太币作为抵押，根据抵押的以太币数量和时间，按比例分配区块的记账权和经济奖励。如果攻击者想要篡改数据，需要先在全网达成共识，篡改操作将记录在区块链当中，篡改结果也会被记录在状态数据库中，因此共识机制的存在 既提高了以太坊平台的性能，又保障了数据的一致性和安全性。

**4.4.1.2 访问可信性**

访问可信性是指数据存证后的可审计及可追溯。本文提供了2种访问方式，一是调用智能合约方法，二是依据智能合约的编码规则对交易信息进行解码，两种方式都保证了数据被访问时的正确性。

在数据层，以太坊以 Key-Value 数据库存储索引数据与状态数据，使得系统可以基于交易哈希检索交易数据，或者基于区块哈希检索区块数据。这与传统数据库的预写式日志 非常类似，区块数据按照日志文件格式存储，以追加形式写 入，支持数据重放，维护了所有的历史操作记录。另外，Merkle树的结构维护一个区块内的事务之间的关系，以太坊区块数据具备了预写式日志不具备的不可篡改性和可追溯性。

在智能合约层，本文系统中的合约方法提供了查询操作，无需共识，也不会更改合约状态值，调用取证函数则就获取到最新存入区块的数据。此外，本文依据智能合约的编码规则还原数据的存储过程，基于区块哈希检索区块数据，又基于区块数据中的交易哈希检索交易数据，通过解码交易数据中的Input字段来还原存证数据。

在激励层（应用层），以太坊除了基于以太币的数字货币交易，还支持去中心化应用，文本基于Node.js语言构建Web前端应用通过 JSON-RPC 与运行在以太坊节点上的智能合约进行 通信，支持访问可信的区块数据、交易数据和状态数据，使 应用程序拥有良好交互性的用户界面。

**4.4.1.3 处理可信性**

处理可信性是指数据处理的正确性，系统需要保存数据的最终状态。在传统的数据库管理系统中，用户通过提交事务来处理数据，事务常由过程型语言与SQL语句组合共同构成，事务执行的过程或结果通过日志进行记录。区块链的逻辑结构与传统数据库管理系统中的日志有所相似，但比特币区块链仅支持挖矿与转账功能，功能上适用于数字货币，对于数据的处理具有很大的局限性。以太坊的智能合约提供了区块链中的数据处理功能，但如果直接将以太坊作为传统的数据库系统来处理数据，会有无法处理不同文件格式、无法 提供查询功能及存储成本昂贵效率低下的缺陷。

MongoDB 数据库对存证数据进行集中式统一处理，将任意文件格式的数据分割为块，块集合存储于fs.chunks，文件元数据存储于fs.files，提取数据的ID和MD5值进行后续的分布式智能合约存储。MD5 算法具有压缩性、容易计算、抗修改性、弱抗碰撞和强抗碰撞的特点，如果在分布式存储的过程中数据被某些人做了改动，那么得到的MD5值将有很大变化。此外，原始文件经过MD5加密后为 32 位的字符串，能够给定固定大小的空间存储、传输和验证，大大地降低了存证成本，也提供了通道验证数据的完整性，确保系统的处理可信性。

**4.5 小结**

本小结提出了一种在以太坊平台上基于智能合约的可信存证系统。存证后数据全链条每个节点都有存证，数据分布式完整、不可篡改、安全可信，适用于有信任公关危机的机构，可以直接从运维的节点获取和验证数据，把存证数据视为直接证据，不再需要第三方机构出具证明。

在未来的工作中，可以考虑在智能合约中增加访问限制，只有特定的用户可以调用合约方法，但任然允许任何人访问合约，确保可信存证系统的公开公正。

   

​            

​         